# MVP To-Do Plan (Декомпозированный)

## Общая цель MVP
Предоставить владельцам бизнеса минимально необходимый функционал для создания и управления своим онлайн-магазином в Telegram Web App, включая управление товарами, прием заказов и базовую административную панель, с поддержкой мультитенантности.

## I. sellerGoApi (Backend API & Database)

### A. Задачи по базе данных

1.  **Проектирование таблицы `tg_users`**
    *   **Статус**: Реализовано.
    *   **Описание**: Создана отдельная таблицу `tg_users` для хранения глобальных пользователей Telegram.
    *   **Service Impact**: `sellerGoApi` (модели, запросы к БД).
    *   **Подзадачи**:
        *   Определить структуру `tg_users` в Go struct. (Реализовано: `internal/models/tg_bot_user.go`)
        *   Реализовать базовые CRUD операции для `tg_users` в `tg_user_store.go`. (Реализовано)
        *   Написать миграцию для создания таблицы `tg_users`. (Реализовано: `0006_create_tg_users_table.up.sql`)

2.  **Проектирование мультитенантной схемы БД (с учетом пользователей)**
    *   **Статус**: Реализовано.
    *   **Описание**: Добавлен `tenant_id` (UUID) как внешний ключ к таблицам `products`, `orders`, `categories`, `users`.
    *   **Service Impact**: `sellerGoApi` (модели, запросы к БД).
    *   **Подзадачи**:
        *   Обновить Go struct для `User` (клиента магазина), включив `tg_user_id` и `tenant_id`. (Реализовано: `internal/models/user.go`)
        *   Обновить Go structs для `Order`, `Product`, `Category` для включения `tenant_id`. (Реализовано: `internal/models/order.go`, `product.go`, `category.go`)
        *   Написать миграцию для создания/обновления таблицы `users` с `tg_user_id` и `tenant_id`. (Реализовано: `0007_add_multitenancy_to_schema.up.sql`)
        *   Написать миграции для добавления `tenant_id` к `products`, `orders`, `categories`. (Реализовано: `0007_add_multitenancy_to_schema.up.sql`)

3.  **Базовые CRUD операции для арендаторов (теннантов)**
    *   **Статус**: В процессе.
    *   **Описание**: Реализовать функции для создания, чтения, обновления и удаления записей о бизнесах/арендаторах в таблице `tenants`.
    *   **Service Impact**: `sellerGoApi` (store, manager, handlers).
    *   **Подзадачи**:
        *   Реализовать `CreateTenant`, `GetTenantByID`, `UpdateTenant`, `DeleteTenant` в `tenant_store.go`. (Реализовано)
        *   Реализовать соответствующую бизнес-логику в `tenant_manager.go`. (Реализовано)
        *   Создать API-эндпоинты `/tenants` (POST, GET, PUT, DELETE) в `handler.go` для управления арендаторами (доступно только для администраторов платформы). (Реализовано)
        *   **Swagger**: Обновить документацию Swagger для эндпоинтов `/tenants`. (Реализовано)

### B. API Эндпоинты

1.  **Регистрация арендатора**
    *   **Статус**: Реализовано.
    *   **Описание**: Эндпоинт для регистрации нового бизнеса/арендатора.
    *   **Service Impact**: `sellerGoApi`, `sellerAdmin`.
    *   **Подзадачи**:
        *   **sellerGoApi**: Создать эндпоинт `POST /register-tenant` (или аналогичный) для создания нового арендатора и первого пользователя-администратора этого арендатора. (Реализовано)
        *   **sellerGoApi**: Обновить `user_store.go` и `user_manager.go` для привязки пользователя-администратора к `tenant_id`. (Частично реализовано: `internal/store/user_store.go`, `internal/managers/user_manager.go` существуют, но требуют доработки для `tenant_id`)
        *   **Swagger**: Обновить документацию Swagger для `POST /register-tenant`. (Реализовано)
        *   **sellerAdmin**: Разработать UI-форму для регистрации нового бизнеса, которая вызывает `POST /register-tenant`. (Реализовано)

2.  **Аутентификация и авторизация**
    *   **Статус**: Реализовано.
    *   **Описание**: Реализована аутентификация на основе JWT и авторизация на основе `tenant_id`.
    *   **Service Impact**: `sellerGoApi`, `sellerAdmin`, `seller`.
    *   **Подзадачи**:
        *   **sellerGoApi**: Эндпоинт `POST /auth/admin` возвращает JWT-токен, содержащий `user_id` и `tenant_ids`. (Реализовано)
        *   **sellerGoApi**: Middleware для проверки JWT-токена и извлечения `tenant_id` для всех защищенных эндпоинтов. (Реализовано)
        *   **sellerGoApi**: Механизмы авторизации, гарантирующие доступ только к данным своего арендатора на основе `tenant_id` из токена. (Реализовано для продуктов и заказов)
        *   **Swagger**: Обновлена документация Swagger для эндпоинтов аутентификации и защищенных маршрутов. (Реализовано)
        *   **sellerAdmin**: UI-форма входа, сохранение JWT-токена. (Реализовано)
        *   **sellerAdmin**: Реализация отправки JWT-токена с каждым запросом к `sellerGoApi`. (Реализовано)
        *   **seller**: Механизмы получения `tenant_id` из URL и передача в API. (Реализовано)

3.  **Управление продуктами**
    *   **Статус**: Реализовано.
    *   **Описание**: Эндпоинты для CRUD операций с продуктами для конкретного арендатора.
    *   **Service Impact**: `sellerGoApi`, `sellerAdmin`, `seller`.
    *   **Подзадачи**:
        *   **sellerGoApi**: Эндпоинты `GET /products`, `GET /products/{id}`, `POST /products`, `PUT /products/{id}`, `DELETE /products/{id}`. Все операции фильтруются по `tenant_id` из токена. (Реализовано)
        *   **sellerGoApi**: Реализовать логику загрузки изображений продуктов (например, сохранение на диск или S3 и сохранение URL в БД). (Не реализовано)
        *   **Swagger**: Обновить документацию Swagger для эндпоинтов продуктов. (Реализовано)
        *   **sellerAdmin**: UI для просмотра списка продуктов, добавления нового продукта, редактирования и удаления. (Реализовано)
        *   **seller**: UI для отображения списка продуктов и деталей продукта. (Реализовано)

4.  **Управление категориями**
    *   **Описание**: Эндпоинты для CRUD операций с категориями продуктов для конкретного арендатора.
    *   **Service Impact**: `sellerGoApi`, `sellerAdmin`, `seller`.
    *   **Подзадачи**:
        *   **sellerGoApi**: Эндпоинты `GET /categories`, `POST /categories`, `PUT /categories/{id}`, `DELETE /categories/{id}`. Все операции должны фильтроваться по `tenant_id`. (Реализовано)
        *   **Swagger**: Обновить документацию Swagger для эндпоинтов категорий. (Реализовано)
        *   **sellerAdmin**: UI для просмотра списка категорий, добавления, редактирования и удаления. (Реализовано)
        *   **seller**: UI для отображения категорий и фильтрации продуктов по категориям. (Реализовано)

5.  **Создание заказа**
    *   **Описание**: Эндпоинт для приема заказов от `seller`.
    *   **Service Impact**: `sellerGoApi`, `seller`.
    *   **Подзадачи**:
        *   **sellerGoApi**: Эндпоинт `POST /orders` для создания нового заказа. Должен принимать `tenant_id`, `tg_user_id`, список продуктов, количество, контактные данные клиента. (Реализовано)
        *   **sellerGoApi**: Логика создания/обновления `tg_user` в таблице `tg_users` при получении заказа. (Реализовано)
        *   **sellerGoApi**: Логика создания/обновления `user` (клиента магазина) в таблице `users`, связывая его с `tg_user_id` и `tenant_id`. (Реализовано)
        *   **sellerGoApi**: Обновить `order_store.go` и `order_manager.go` для сохранения заказа с `tenant_id` и `user_id` (клиента магазина). (Реализовано)
        *   **Swagger**: Обновить документацию Swagger для `POST /orders`. (Реализовано)
        *   **seller**: Реализовать логику отправки данных корзины, `tg_user_id` и контактных данных клиента на `POST /orders`. (Реализовано)

6.  **Получение и обновление статуса заказа**
    *   **Описание**: Эндпоинты для `sellerAdmin` для получения списка заказов и обновления их статусов.
    *   **Service Impact**: `sellerGoApi`, `sellerAdmin`.
    *   **Подзадачи**:
        *   **sellerGoApi**: Эндпоинты `GET /orders` (список заказов для арендатора), `GET /orders/{id}`, `PUT /orders/{id}/status`. (Реализовано)
        *   **Swagger**: Обновить документацию Swagger для эндпоинтов заказов. (Реализовано)
        *   **sellerAdmin**: UI для просмотра списка заказов и деталей заказа. (Реализовано)
        *   **sellerAdmin**: UI для выбора и обновления статуса заказа. (Реализовано)

7.  **Управление пользователями (клиентами магазина)**
    *   **Описание**: Эндпоинты для `sellerAdmin` для просмотра клиентов конкретного магазина.
    *   **Service Impact**: `sellerGoApi`, `sellerAdmin`.
    *   **Подзадачи**:
        *   **sellerGoApi**: Эндпоинт `GET /customers` (список клиентов для арендатора, т.е. записи из таблицы `users` для данного `tenant_id`). (Реализовано)
        *   **Swagger**: Обновить документацию Swagger для эндпоинта клиентов. (Реализовано)
        *   **sellerAdmin**: UI для просмотра списка клиентов, совершивших заказы в магазине. (Реализовано)

### C. Основная логика

1.  **Реализация мультитенантной логики**
    *   **Описание**: Обеспечение строгой изоляции данных между различными арендаторами на уровне API.
    *   **Service Impact**: `sellerGoApi` (middleware, managers, stores).
    *   **Подзадачи**:
        Разработать middleware для извлечения `tenant_id` из JWT-токена и передачи его в контекст запроса. (Реализовано)
        Модифицировать все запросы к БД в `store` слое для включения фильтрации по `tenant_id`. (Реализовано)
        *   Написать юнит-тесты для проверки изоляции данных. (Не реализовано)

2.  **Автоматическое создание/обновление `tg_user` и `user` (клиента магазина)**
    *   **Описание**: Логика автоматического создания или обновления записей в таблицах `tg_users` и `users` при первом взаимодействии `tg_user` с магазином (например, при оформлении заказа).
    *   **Service Impact**: `sellerGoApi` (order_manager, user_manager, tg_user_manager).
    *   **Подзадачи**:
        *   Создать `tg_user_manager` и `user_manager` для инкапсуляции логики работы с этими сущностями. (Реализовано)
        *   В `order_manager.go` реализовать проверку наличия `tg_user` по `tg_user_id`. Если нет, создать. (Реализовано)
        *   В `order_manager.go` реализовать проверку наличия `user` (клиента магазина) по `tg_user_id` и `tenant_id`. Если нет, создать и связать с `tg_user`. (Реализовано)

3.  **Базовое логирование ошибок**
    *   **Описание**: Настройка системы логирования для отслеживания проблем.
    *   **Service Impact**: `sellerGoApi`.
    *   **Подзадачи**:
        *   Интегрировать библиотеку логирования (например, Zap, Logrus). (Реализовано)
        *   Настроить уровни логирования (info, warn, error). (Реализовано)
        *   Логировать критические ошибки и запросы. (Реализовано)

## II. sellerAdmin (Admin Panel для владельцев бизнеса)

### A. Аутентификация и авторизация

1.  **Вход/Выход**
    *   **Описание**: Функционал для входа и выхода владельцев бизнеса.
    *   **Service Impact**: `sellerAdmin`, `sellerGoApi`.
    *   **Подзадачи**:
        *   **sellerAdmin**: Создать страницу входа с формой для email/пароля. (Предположительно реализовано: `sellerAdmin/src/pages/LoginPage.tsx` существует)
        *   **sellerAdmin**: Отправка данных на `sellerGoApi: POST /login`. (Предположительно реализовано: `sellerAdmin/src/apiClient.ts` может это делать)
        *   **sellerAdmin**: Сохранение полученного JWT-токена в локальном хранилище (localStorage/sessionStorage). (Предположительно реализовано)
        *   **sellerAdmin**: Реализация кнопки "Выход" и очистка токена. (Не реализовано)
        *   **sellerAdmin**: Защита маршрутов (роутов) админ-панели на основе наличия и валидности токена. (Не реализовано)

2.  **Контроль доступа**
    *   **Описание**: Обеспечение того, что владелец бизнеса может управлять только данными своего арендатора.
    *   **Service Impact**: `sellerAdmin`, `sellerGoApi`.
    *   **Подзадачи**:
        *   **sellerAdmin**: Настроить `apiClient.ts` для автоматического добавления JWT-токена в заголовки всех запросов к `sellerGoApi`. (Предположительно реализовано)
        *   **sellerGoApi**: (Уже покрыто в I.B.2) Middleware для проверки токена и `tenant_id`. (Не реализовано)

### B. Управление арендатором/магазином

1.  **Дашборд**
    *   **Описание**: Простая панель управления для владельцев бизнеса.
    *   **Service Impact**: `sellerAdmin`.
    *   **Подзадачи**:
        *   Создать базовую страницу дашборда с приветствием и ссылками на основные разделы (продукты, заказы). (Не реализовано)

2.  **Информация о магазине**
    *   **Описание**: Раздел для просмотра и редактирования основной информации о магазине (название, контакты).
    *   **Service Impact**: `sellerAdmin`, `sellerGoApi`.
    *   **Подзадачи**:
        *   **sellerGoApi**: Эндпоинт `GET /tenant/me` (или аналогичный) для получения информации о текущем арендаторе. (Не реализовано)
        *   **sellerGoApi**: Эндпоинт `PUT /tenant/me` для обновления информации об арендаторе. (Не реализовано)
        *   **Swagger**: Обновить документацию. (Не реализовано)
        *   **sellerAdmin**: UI-страница "Настройки магазина" с формой для отображения и редактирования данных. (Предположительно реализовано: `sellerAdmin/src/pages/Settings.tsx` существует, но требует **проверки функционала**)

### C. Управление продуктами

1.  **UI для добавления продуктов**
    *   **Описание**: Форма для ввода названия, описания, цены, загрузки изображения продукта.
    *   **Service Impact**: `sellerAdmin`, `sellerGoApi`.
    *   **Подзадачи**:
        *   **sellerAdmin**: Создать страницу "Добавить продукт" с формой. (Предположительно реализовано: `sellerAdmin/src/pages/Products.tsx` может содержать эту форму)
        *   **sellerAdmin**: Реализовать компонент для загрузки файла изображения. (Не реализовано)
        *   **sellerAdmin**: Отправка данных формы (включая файл изображения) на `sellerGoApi: POST /products`. (Предположительно реализовано: `sellerAdmin/src/pages/Products.tsx` может вызывать API, но требует **проверки**)

2.  **UI для просмотра, редактирования и удаления продуктов**
    *   **Описание**: Таблица или список продуктов с возможностью их изменения.
    *   **Service Impact**: `sellerAdmin`, `sellerGoApi`.
    *   **Подзадачи**:
        *   **sellerAdmin**: Создать страницу "Список продуктов". (Предположительно реализовано: `sellerAdmin/src/pages/Products.tsx` существует)
        *   **sellerAdmin**: Вызов `sellerGoApi: GET /products` для получения списка. (Предположительно реализовано: `sellerAdmin/src/pages/Products.tsx` может вызывать API)
        *   **sellerAdmin**: Таблица для отображения продуктов с кнопками "Редактировать" и "Удалить". (Предположительно реализовано: `sellerAdmin/src/pages/Products.tsx` может содержать эту таблицу)
        *   **sellerAdmin**: Модальное окно или отдельная страница для редактирования продукта (вызов `PUT /products/{id}`). (Не реализовано)
        *   **sellerAdmin**: Подтверждение удаления и вызов `DELETE /products/{id}`. (Не реализовано)

3.  **UI для управления категориями продуктов**
    *   **Описание**: Создание, редактирование, удаление категорий.
    *   **Service Impact**: `sellerAdmin`, `sellerGoApi`.
    *   **Подзадачи**:
        *   **sellerAdmin**: Создать страницу "Категории". (Не реализовано)
        *   **sellerAdmin**: Вызов `sellerGoApi: GET /categories`. (Не реализовано)
        *   **sellerAdmin**: UI для добавления новой категории (вызов `POST /categories`). (Не реализовано)
        *   **sellerAdmin**: UI для редактирования и удаления категорий (вызов `PUT /categories/{id}`, `DELETE /categories/{id}`). (Не реализовано)

### D. Управление заказами

1.  **Список заказов**
    *   **Описание**: UI для просмотра списка всех заказов для их магазина.
    *   **Service Impact**: `sellerAdmin`, `sellerGoApi`.
    *   **Подзадачи**:
        *   **sellerAdmin**: Создать страницу "Заказы". (Предположительно реализовано: `sellerAdmin/src/pages/Orders.tsx` существует)
        *   **sellerAdmin**: Вызов `sellerGoApi: GET /orders` для получения списка заказов. (Предположительно реализовано: `sellerAdmin/src/pages/Orders.tsx` может вызывать API)
        *   **sellerAdmin**: Таблица для отображения заказов с основной информацией (номер, дата, статус, сумма). (Предположительно реализовано: `sellerAdmin/src/pages/Orders.tsx` может содержать эту таблицу)

2.  **Детали заказа**
    *   **Описание**: UI для просмотра подробной информации о конкретном заказе (состав, данные клиента).
    *   **Service Impact**: `sellerAdmin`, `sellerGoApi`.
    *   **Подзадачи**:
        *   **sellerAdmin**: Создать страницу "Детали заказа" (или модальное окно). (Не реализовано)
        *   **sellerAdmin**: Вызов `sellerGoApi: GET /orders/{id}`. (Не реализовано)
        *   **sellerAdmin**: Отображение списка заказанных товаров, их количества, цены, общей суммы и данных клиента (включая информацию о `tg_user_id`, если доступно). (Не реализовано)

3.  **Обновление статуса заказа**
    *   **Описание**: UI для изменения статуса заказа.
    *   **Service Impact**: `sellerAdmin`, `sellerGoApi`.
    *   **Подзадачи**:
        *   **sellerAdmin**: Добавить выпадающий список или кнопки для изменения статуса заказа на странице деталей заказа. (Не реализовано)
        *   **sellerAdmin**: Вызов `sellerGoApi: PUT /orders/{id}/status` с новым статусом. (Не реализовано)

## III. seller (Telegram Web App Витрина)

### A. Отображение витрины

1.  **Отображение продуктов и категорий**
    *   **Описание**: Получение и отображение продуктов и категорий из `sellerGoApi` для конкретного арендатора.
    *   **Service Impact**: `seller`, `sellerGoApi`.
    *   **Подзадачи**:
        *   **seller**: Механизм получения `tenant_id` (например, из URL-параметра Telegram Web App) и `tg_user_id` (из Telegram Web App SDK). (Частично реализовано: `seller/src/hooks/useTelegram.ts` существует, но получение `tenant_id` и передача в API требует **доработки**)
        *   **seller**: Вызов `sellerGoApi: GET /products` (с `tenant_id` в заголовке или параметре). (Предположительно реализовано: `seller/src/services/ProductService.ts` существует)
        *   **seller**: Вызов `sellerGoApi: GET /categories` (с `tenant_id`). (Не реализовано)
        *   **seller**: Компоненты для отображения списка продуктов и категорий. (Предположительно реализовано: `seller/src/pages/MenuPage.tsx`, `Card` компоненты существуют)
        *   **seller**: Реализация фильтрации продуктов по категориям. (Частично реализовано: `seller/src/pages/MenuPage.tsx` может иметь базовую фильтрацию, но требует **проверки**)

2.  **Страницы деталей продукта**
    *   **Описание**: Отображение подробной информации о выбранном продукте.
    *   **Service Impact**: `seller`, `sellerGoApi`.
    *   **Подзадачи**:
        *   **seller**: Создать страницу "Детали продукта". (Предположительно реализовано: `seller/src/pages/MenuPage/components/Card/CardExpandedContent.tsx` существует)
        *   **seller**: Вызов `sellerGoApi: GET /products/{id}`. (Предположительно реализовано: `seller/src/services/ProductService.ts` существует)
        *   **seller**: Отображение названия, описания, цены, изображения продукта. (Предположительно реализовано: `seller/src/pages/MenuPage/components/Card/CardExpandedContent.tsx` существует)

### B. Корзина покупок

1.  **Добавление/удаление товаров**
    *   **Описание**: Функционал для добавления и удаления товаров в корзину.
    *   **Service Impact**: `seller`.
    *   **Подзадачи**:
        *   Реализовать локальное состояние корзины (например, с использованием React Context). (Предположительно реализовано: `seller/src/contexts/CartContext.tsx` существует)
        *   Кнопки "Добавить в корзину" на карточках продуктов и страницах деталей. (Предположительно реализовано: `seller/src/pages/MenuPage/components/Card/ExpandableCard.tsx` может содержать эту кнопку)
        *   Кнопки "Удалить" или изменение количества в самой корзине. (Предположительно реализовано: `seller/src/pages/DeliveryPage/components/CartDisplay/CartDisplay.tsx` существует)

2.  **Просмотр содержимого корзины**
    *   **Описание**: Отображение выбранных товаров и общей суммы.
    *   **Service Impact**: `seller`.
    *   **Подзадачи**:
        *   Создать страницу "Корзина" с перечнем товаров, их количеством и общей суммой. (Предположительно реализовано: `seller/src/pages/DeliveryPage/components/CartDisplay/CartDisplay.tsx` существует)

### C. Оформление заказа

1.  **Сбор информации о клиенте**
    *   **Описание**: Форма для ввода имени, контактных данных, адреса доставки.
    *   **Service Impact**: `seller`.
    *   **Подзадачи**:
        *   Создать форму оформления заказа. (Предположительно реализовано: `seller/src/pages/DeliveryPage/components/DeliveryAddressForm/DeliveryAddressForm.tsx` существует)
        *   Поля для имени, телефона, адреса доставки, комментариев. (Предположительно реализовано: `seller/src/pages/DeliveryPage/components/DeliveryAddressForm/DeliveryAddressForm.tsx` существует)

2.  **Отправка заказа**
    *   **Описание**: Отправка данных корзины, `tg_user_id` и контактных данных клиента в `sellerGoApi`.
    *   **Service Impact**: `seller`, `sellerGoApi`.
    *   **Подзадачи**:
        *   **seller**: Валидация данных формы. (Не реализовано)
        *   **seller**: Вызов `sellerGoApi: POST /orders` с данными корзины, `tg_user_id`, `tenant_id` и клиента. (Предположительно реализовано: `seller/src/services/OrderService.ts` существует, но требует **доработки** для `tg_user_id` и `tenant_id`)

3.  **Экран подтверждения**
    *   **Описание**: Отображение подтверждения успешного оформления заказа.
    *   **Service Impact**: `seller`.
    *   **Подзадачи**:
        *   Создать страницу или модальное окно с сообщением об успешном заказе. (Предположительно реализовано: `seller/src/pages/DeliveryPage/components/DeliveryScreen/DeliveryScreen.tsx` существует)

### D. Базовый UI/UX

1.  **Функциональный и чистый дизайн**
    *   **Описание**: Использование базовых стилей для обеспечения работоспособности и приятного внешнего вида.
    *   **Service Impact**: `seller`, `sellerAdmin`.
    *   **Подзадачи**:
        *   Определить базовую дизайн-систему (цвета, шрифты, отступы). (Предположительно реализовано: `styles.css` и `.module.css` файлы существуют)
        *   Применить стили к основным компонентам и страницам. (Предположительно реализовано)

2.  **Интеграция с Telegram Web App**
    *   **Описание**: Использование хуков и API Telegram для оптимальной работы в среде Telegram.
    *   **Service Impact**: `seller`.
    *   **Подзадачи**:
        *   Инициализация Telegram Web App SDK. (Предположительно реализовано: `seller/src/hooks/useTelegram.ts` существует)
        *   Использование `useTelegram` хука для получения данных пользователя и управления UI Telegram. (Предположительно реализовано: `seller/src/hooks/useTelegram.ts` существует)

---
**Примечание**: Этот план является детализированной дорожной картой MVP. Каждая задача должна выполняться с учетом сквозных изменений во всех затронутых сервисах (API, Swagger, Frontend).
